<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Local Shop Finder â€” Demo</title>
<style>
/* Vibrant professional UI */
:root{
--bg1:#00c6ff; --bg2:#0072ff; --card:#ffffff; --muted:#6b7280;
--accent:#ff7a59; --accent2:#ff3d8a; --success:#2ecc71;
}
body{
margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
background: linear-gradient(180deg,#e7f8ff 0%, #f0f7ff 100%);
color:#0f1724;
}
header{
background: linear-gradient(90deg,var(--accent),var(--accent2));
color:white;padding:18px 16px;display:flex;align-items:center;justify-content:space-between;
gap:12px;box-shadow:0 6px 18px rgba(2,6,23,0.12);
}
header h1{font-size:18px;margin:0}
header .tag{font-weight:700;background:rgba(255,255,255,0.12);padding:8px 10px;border-radius:10px}
.wrap{max-width:980px;margin:18px auto;padding:0 16px;}
.grid{display:grid;grid-template-columns:1fr 420px;gap:18px}
@media (max-width:920px){ .grid{grid-template-columns:1fr} }
.card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
input[type="text"], input[type="number"], select, textarea{
width:100%;padding:10px;border-radius:10px;border:1px solid rgba(15,23,36,0.08);margin-bottom:10px;
font-size:14px;color:#0f1724;
}
.row{display:flex;gap:8px}
.row .half{flex:1}
button{
background:linear-gradient(90deg,var(--bg1),var(--bg2));color:white;border:none;padding:10px 12px;border-radius:10px;
cursor:pointer;font-weight:700;
}
button.secondary{background:transparent;border:1px solid rgba(15,23,36,0.06);color:var(--muted)}
.small{font-size:13px;color:var(--muted)}
.item-row{display:flex;gap:8px;align-items:center;margin-bottom:8px;flex-wrap:wrap}
.item-row input, .item-row select{flex:1;min-width:110px}
.item-row .remove{flex:0 0 36px;background:#fee2e2;color:#9b1c1c;border-radius:8px;border:none}
.shop-list .shop-card{border-radius:10px;padding:12px;margin-bottom:12px;background:#fff;box-shadow:0 6px 18px rgba(2,6,23,0.04);border-left:4px solid #0072ff}
.shop-list .shop-card.cheapest{border-left-color:var(--success);background:#f0fff4}
.muted{color:var(--muted);font-size:13px}
.center{display:flex;gap:8px;align-items:center}
.hint{font-size:13px;color:#475569}
</style>
</head>
<body>

<header>
<h1>Local Shop Finder</h1>
<div class="tag">Demo â€¢ Local</div>
</header>

<main class="wrap">
<div class="grid">
<!-- LEFT: Search & Results -->
<section>
<div class="card">
<h2 style="margin:0 0 10px 0;color:#0b69ff">Search items nearby</h2>
<label>Item name</label>
<input id="searchItem" type="text" placeholder="e.g., tomatoes, rice, milk">

<div class="row">
<div class="half">
<label>Max distance (km)</label>
<input id="maxDistance" type="number" placeholder="e.g., 5" min="0">
</div>
<div class="half">
<label>User location (lat, lng)</label>
<div style="display:flex;gap:8px">
<input id="userLat" type="text" placeholder="lat">
<input id="userLng" type="text" placeholder="lng">
</div>
</div>
</div>

<div style="display:flex;gap:8px;margin-top:8px">
<button onclick="useMyLocationForSearch()">Use my location</button>
<button class="secondary" onclick="search()">Search</button>
</div>

<div id="searchMessage" class="small" style="margin-top:10px"></div>
</div>

<div id="resultsContainer" class="card" style="margin-top:14px">
<h3 style="margin:0 0 8px 0;color:#0b69ff">Results</h3>
<div id="resultsList" class="shop-list"></div>
</div>
</section>

<!-- RIGHT: Shopkeeper Registration & Registered shops -->
<aside>
<div class="card">
<h3 style="margin-top:0;color:#0b69ff">Register as Shopkeeper</h3>
<label>Shop name</label>
<input id="shopName" type="text" placeholder="My Grocery, ABC Store">

<label>Shop address (optional)</label>
<input id="shopAddress" type="text" placeholder="Street, City, State">

<label>Shop coordinates (lat, lng) â€” or use button</label>
<div class="row">
<input id="shopLat" type="text" placeholder="lat">
<input id="shopLng" type="text" placeholder="lng">
</div>
<div style="display:flex;gap:8px;margin-bottom:10px">
<button onclick="useMyLocationForShop()">Use my location</button>
<button class="secondary" onclick="fillDemoCoords()">Fill example coords</button>
</div>

<label>Items (name, price, unit). Add as many as you want:</label>
<div id="itemsBox"></div>
<div style="display:flex;gap:8px;margin-top:8px">
<button onclick="addItemRow()">+ Add item</button>
<button class="secondary" onclick="clearItemRows()">Reset items</button>
</div>

<div style="display:flex;gap:8px;margin-top:12px">
<button onclick="registerShop()">âœ… Register Shop</button>
<button class="secondary" onclick="resetRegistration()">Clear</button>
</div>

<div class="small" style="margin-top:10px">Tip: Tap "Use my location" to auto-fill coordinates. Registered shops persist in your browser.</div>
</div>

<div class="card" style="margin-top:14px">
<h3 style="margin:0 0 8px 0;color:#0b69ff">Registered shops (<span id="shopsCount">0</span>)</h3>
<div id="registeredShops"></div>
</div>
</aside>
</div>
</main>

<script>
/* Utility: Haversine distance (km) */
function haversineKm(lat1, lon1, lat2, lon2){
const toRad = v => v * Math.PI/180;
const R = 6371;
const dLat = toRad(lat2 - lat1);
const dLon = toRad(lon2 - lon1);
const a = Math.sin(dLat/2) * Math.sin(dLat/2)
+ Math.cos(toRad(lat1)) * Math.cos(toRad(lat2))
* Math.sin(dLon/2) * Math.sin(dLon/2);
const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
return R * c;
}

/* Local storage key */
const STORAGE_KEY = "local_shops_v1";

/* Demo shops (with lat/lng) â€” only loaded if nothing in storage */
const DEMO_SHOPS = [
{ name:"Metro Fresh Grocers", address:"Sector 12 Market", lat:28.7041, lng:77.1025,
items:[ {name:"rice", price:420, unit:"per 5 kg"}, {name:"tomatoes", price:38, unit:"per kg"}, {name:"paracetamol", price:50, unit:"per strip"} ]
},
{ name:"Neighborhood Kirana", address:"MG Road", lat:28.7090, lng:77.0950,
items:[ {name:"rice", price:398, unit:"per 5 kg"}, {name:"tomatoes", price:35, unit:"per kg"}, {name:"sugar", price:48, unit:"per kg"} ]
},
{ name:"Organic Produce", address:"River Road", lat:28.7150, lng:77.1000,
items:[ {name:"tomatoes", price:30, unit:"per kg"}, {name:"basmati rice", price:520, unit:"per 5 kg"} ]
}
];

/* Load or initialize shops */
let shops = JSON.parse(localStorage.getItem(STORAGE_KEY) || "null");
if (!Array.isArray(shops)) {
shops = DEMO_SHOPS.slice();
localStorage.setItem(STORAGE_KEY, JSON.stringify(shops));
}
renderRegisteredShops();

/* Items UI helpers */
function addItemRow(name='', price='', unit='per kg'){
const box = document.getElementById("itemsBox");
const row = document.createElement("div");
row.className = "item-row";
row.innerHTML = `
<input class="item-name" type="text" placeholder="Item name" value="${escapeHtmlAttr(name)}">
<input class="item-price" type="number" placeholder="Price" value="${price}">
<select class="item-unit">
<option ${unit==='per kg'?'selected':''}>per kg</option>
<option ${unit==='per liter'?'selected':''}>per liter</option>
<option ${unit==='per piece'?'selected':''}>per piece</option>
<option ${unit==='per dozen'?'selected':''}>per dozen</option>
<option ${unit==='per 5 kg'?'selected':''}>per 5 kg</option>
</select>
<button class="remove" type="button" onclick="this.parentNode.remove()">âœ–</button>
`;
box.appendChild(row);
}
function clearItemRows(){
document.getElementById("itemsBox").innerHTML = "";
addItemRow();
}

/* Fill example coords (helpful while testing) */
function fillDemoCoords(){
document.getElementById("shopLat").value = "28.7041";
document.getElementById("shopLng").value = "77.1025";
}

/* Use browser geolocation to fill shop coordinates */
function useMyLocationForShop(){
if (!navigator.geolocation){ alert('Geolocation not supported.'); return; }
navigator.geolocation.getCurrentPosition(pos=>{
document.getElementById("shopLat").value = pos.coords.latitude.toFixed(6);
document.getElementById("shopLng").value = pos.coords.longitude.toFixed(6);
}, err=>{ alert("Couldn't fetch location: "+(err.message||err.code)); }, { enableHighAccuracy:true, timeout:10000 });
}

/* Use browser geolocation for search user location */
function useMyLocationForSearch(){
if (!navigator.geolocation){ alert('Geolocation not supported.'); return; }
navigator.geolocation.getCurrentPosition(pos=>{
document.getElementById("userLat").value = pos.coords.latitude.toFixed(6);
document.getElementById("userLng").value = pos.coords.longitude.toFixed(6);
}, err=>{ alert("Couldn't fetch location: "+(err.message||err.code)); }, { enableHighAccuracy:true, timeout:10000 });
}

/* Register shopkeeper */
function registerShop(){
const name = document.getElementById("shopName").value.trim();
const address = document.getElementById("shopAddress").value.trim();
const latStr = document.getElementById("shopLat").value.trim();
const lngStr = document.getElementById("shopLng").value.trim();
const lat = parseFloat(latStr), lng = parseFloat(lngStr);

if (!name){ alert("Please enter shop name."); return; }
if (isNaN(lat) || isNaN(lng)){ alert("Please provide shop coordinates (lat & lng) or use 'Use my location'."); return; }

const itemRows = document.querySelectorAll("#itemsBox .item-row");
const items = [];
itemRows.forEach(row=>{
const nm = row.querySelector(".item-name").value.trim();
const pr = parseFloat(row.querySelector(".item-price").value);
const un = row.querySelector(".item-unit").value;
if (nm && !isNaN(pr)) items.push({ name: nm.toLowerCase(), displayName: nm, price: pr, unit: un });
});

if (items.length === 0){ alert("Please add at least one item with valid price."); return; }

shops.push({ name, address, lat, lng, items });
localStorage.setItem(STORAGE_KEY, JSON.stringify(shops));
alert("Shop registered and saved! ðŸŽ‰");
// reset form
document.getElementById("shopName").value = "";
document.getElementById("shopAddress").value = "";
document.getElementById("shopLat").value = "";
document.getElementById("shopLng").value = "";
clearItemRows();
renderRegisteredShops();
}

/* Search function */
function search(){
const q = (document.getElementById("searchItem").value || "").trim().toLowerCase();
const maxD = parseFloat(document.getElementById("maxDistance").value);
const userLat = parseFloat(document.getElementById("userLat").value);
const userLng = parseFloat(document.getElementById("userLng").value);
const resultsList = document.getElementById("resultsList");
const msg = document.getElementById("searchMessage");
resultsList.innerHTML = ""; msg.textContent = "";

if (!q){ alert("Please enter an item name to search."); return; }
if (isNaN(maxD) || isNaN(userLat) || isNaN(userLng)){ alert("Please enter your location (lat, lng) and max distance."); return; }

const matches = [];
shops.forEach(shop=>{
const distanceKm = haversineKm(userLat, userLng, shop.lat, shop.lng);
if (distanceKm <= maxD + 1e-9){
shop.items.forEach(item=>{
// substring match so 'rice' finds 'basmati rice'
if (item.name.toLowerCase().includes(q)){
matches.push({
shopName: shop.name,
address: shop.address,
lat: shop.lat, lng: shop.lng,
price: item.price,
unit: item.unit,
itemDisplay: item.displayName || item.name,
distance: distanceKm
});
}
});
}
});

if (matches.length === 0){
resultsList.innerHTML = `<div class="muted" style="padding:12px">Item not found within ${maxD} km.</div>`;
return;
}

matches.sort((a,b)=>a.price - b.price);

matches.forEach((m, i) => {
const div = document.createElement("div");
div.className = "shop-card" + (i===0 ? " cheapest" : "");
div.innerHTML = `
<div style="display:flex;justify-content:space-between;align-items:center">
<div>
<strong style="font-size:15px">${escapeHtml(m.shopName)}</strong><br>
<span class="muted">${escapeHtml(m.address || '')} â€¢ ${m.distance.toFixed(2)} km</span>
</div>
<div style="text-align:right">
<div style="font-weight:800;font-size:18px">â‚¹${m.price}</div>
<div style="font-size:13px;color:#374151">${escapeHtml(m.unit)}</div>
</div>
</div>
<div style="margin-top:8px" class="muted">Item: ${escapeHtml(m.itemDisplay)}</div>
`;
resultsList.appendChild(div);
});

msg.textContent = `${matches.length} shop(s) found â€” cheapest highlighted.`;
}

/* Show registered shops summary */
function renderRegisteredShops(){
const container = document.getElementById("registeredShops");
container.innerHTML = "";
document.getElementById("shopsCount").textContent = shops.length;
shops.forEach((s, idx)=>{
const c = document.createElement("div");
c.style.padding="8px"; c.style.borderBottom="1px dashed rgba(15,23,36,0.06)";
c.innerHTML = `<strong>${escapeHtml(s.name)}</strong><div class="muted">${escapeHtml(s.address || '')}</div>
<div class="muted">Coords: ${s.lat.toFixed(4)}, ${s.lng.toFixed(4)}</div>
<div style="margin-top:6px">${s.items.map(it=>escapeHtml(it.displayName||it.name)+" â€” â‚¹"+it.price+" "+escapeHtml(it.unit)).join("<br>")}</div>`;
container.appendChild(c);
});
}

/* small helpers */
function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[c]);}
function escapeHtmlAttr(s){ return String(s||'').replace(/"/g,'&quot;').replace(/'/g,"&#39;");}

/* initialize UI */
clearItemRows();
renderRegisteredShops();
</script>

</body>
</html>